<%= render partial: 'layouts/application_render' %>

<h4>Pets Applied For</h4>
<% @application.pets.each do |pet| %>
  <%= link_to "#{pet.name}", "/pets/#{pet.id}" %>
  <p>Approval Status: <%= pet.approval_status_for(@application) %></p>
<% end %>

<% if @application.status == "In Progress" %>
  <h3> Add a Pet to this Application </h3>
  
  <%= form_with url: "/applications/#{@application.id}", method: :get, local: true do |form| %>
    <%= form.label :search %>
    <%= form.text_field :search %>
    <%= form.submit "Search" %>
  <% end %>

  <% if @results %>
    <h3> Search Results </h3>
    <ul>
      <% @results.each do |result| %>
        <li>
          <p>
            <%= result.name %>
            <%= button_to "Adopt this Pet", "/applications/#{@application.id}/pets", params: {pet_id: result.id} %>
          </p>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p>No results found</p>
  <% end %>

  <% if @application.has_pets? %>
    <%= form_with url: "/applications/#{@application.id}", method: :patch, local: true do |form| %>
      <%= form.label :reason_for_adoption, "Please explain why you would be a good home" %>
      <%= form.text_area :reason_for_adoption %>
      <%= form.hidden_field :status, value: "Pending" %><br>
      <%= form.submit "Submit" %>
    <% end %>
  <% end %>
<% end %>


